# 移动端 Chrome 扩展

## 前言

5202年了，移动 chrome 还不支持扩展，是技术原因吗，肯定不是，是利益问题，真的好不爽

移动端浏览器 chrome 用户数肯定是第一的，但是不支持扩展真有点无语。

每隔一段时间我都会去搜一下移动 chrome 支持扩展的消息，很可惜未来一段时间都没希望。

最近偶然间发现安卓 adguard + chrome 能使用 Tampermonkey 一些扩展，但对我来说也足够了

因为在安装配置过程中有很多问题，网上资料又很少，所以写下此教程

## 为什么要使用扩展

当然是要治一下国内移动网页毒瘤啦

首当其冲就是知乎，搜索结果列表页面如果有知乎页面，如果你手机安装了知乎应用，毒瘤会想尽一切办法跳转到应用，真的是恶心。我安装知乎应用可以不用，但是不能你强制我用

然后就是哔哩哔哩，一些视频和文字教程，打开就会跳转应用，然后关闭当前页面

在 chrome 中，虽然可以长按新窗口打开页面，这有点麻烦。如果不用点脚本，根本无解

## 为什么要使用 chrome

是的，移动端 edge firefox 都迎合用户的需求支持扩展了。chrome 不支持，因为是一家独大，无所谓的状态

我移动用 chrome 的原因是同步功能，这是其他浏览器做不到的

## 安装应用，授权获取应用列表（必须）

AdGuard 必须是付费版本，安装完成后，先不要打开，先授权

在国产系统安装 adguard 完成后，可能不会提示授权，要手动打开获取应用列表权限

授权成功后，打开应用直接点击【开始安全浏览网页】进入应用，不用微调

## 安装 CA 证书，开启 HTTPS 过滤（必须）

点击【有些广告未被拦截。了解如何修复此问题。】->【继续】->【下一步】->【保存证书】，按照步骤安装 CA 证书，安装成功后返回应用，会提示【HTTPS 过滤已激活】

## 设置应用权限和过滤（可选）

这里建议只打开需要【过滤广告】的应用和需要【翻墙】的应用

注意：如果全部打开，在开启过滤广告+翻墙代理，层层套娃下，网络连接可能会有问题，不推荐

点击【应用管理】，点击右上角菜单【暂停所有流量的路由】

然后搜索 chrome，打开【通过 adguard 路由流量】

情况1，只想在 chrome 中加载脚本，不用 adguard 过滤广告。额...这个需求好奇葩。简单介绍一下，可以把 adguard 所有选项关闭

## 安装 Tampermonkey 扩展

 不是所有 Tampermonkey 扩展都可以用

 阻止知乎跳转到应用
 
 - 搜索脚本

   https://greasyfork.org 搜索【知乎手机网页优化】

   greasyfork 虽然被强了，但你都上 github 了，小问题。

   还是推荐几个镜像吧

   https://home.greasyfork.org.cn

   https://scriptcat.org/

   点击【安装此脚本】会打开 js 代码页面

   【有梯子】复制页面链接
   
   【无梯子】保存当前 js 文件

- 安装扩展
  
  点击【设置】->【过滤】->【扩展】->【添加扩展程序】->【从文件或 URL 导入】

  【有梯子】填脚本链接
  
  【无梯子】点击浏览选择脚本文件

开启 adguard vpn 就可以使用了

如果没有生效，手动结束运行，重新打开 adguard chrome，经常改一些配置会出现奇奇怪怪问题，一般重新打开都能解决


到此基本可以在 chrome 使用插件了

现在 greasyfork 很多脚本不是为移动端设计的，就算是移动端，通过 adguard 安装，也不一定能用

所以希望有更多人使用到 chrome 脚本，能有更多脚本适配 adguard

然后在 greasyfork 找移动端 adguard 能用的脚本真的很痛苦

比如我需要阻止知乎跳转，只能一个一个去试，这里的【知乎手机网页优化】能阻止知乎登录，算是勉强能用，但是功能没法选择

这里推荐一些能用的，好用的 adguard 脚本，希望能帮到更多人

| Syntax | Description |
| --- | --- |
| [知乎手机网页优化](https://greasyfork.org/scripts/389371) | 阻止应用跳转 |
| [阻止跳转APP for 哔哩哔哩 (゜-゜)つロ 干杯~-bilibili](https://greasyfork.org/scripts/491579) | 阻止应用跳转 |


---

# adguard 过滤广告 + clash 代理

这里坑还是很多的，这里教程使用 FlCash 0.8.91， adguar 4.14.15

首先这个 FlCash，如果普通代理使用没问题，如果涉及一些高级功能，还是有些奇奇怪怪问题，想反馈，但看到它的 issues 数量，还是算了，不添麻烦了

然后这个 adguard，普通过滤广告没问题，加代理，加插件，也是会有奇奇怪怪问题

## 关于 adguard 过滤广告

之前用的 gkd，各有各的好处吧。

目前 adguard 可以过滤掉很多应用的开屏广告，但不会马上跳过开屏，也会停留一会，只是没有广告了

也可以二者合并使用

## 主要问题

如果出现应用打不开，上网慢，主要还是 DNS 的问题

因为目前 clash 默认是 fake ip 模式，在 dns 解析时，返回给 adguard 是假 ip，有些应用会出现打不开

如果设置为 redir host 模式，体验差，因为首先要解析 dns 请求，adguard 转发 dns 请求到 clash，clash 在根据规则去决定本地解析还是远程解析 dns，解析完成返回adguard，adguard在返回chrome，再进行tcp连接

还有redir host是都是ip请求，也就是clash域名分流规则无法使用，clash meta 需要开启 sniffer, 从ip中提取域名，再根据域名分流

最好还是fake ip 模式，当前 flclash 的rule set 有些问题，如果使用 fake ip，一些本地的域名，比如 local.adguard.org ，会进行代理，就会出现chrome插件失效问题

因为 local.adguard.org 是一个chrome 脚本的加载地址，不能被代理，需要返回真实ip

adguard 设置应用分流规则，但是应用流量不设置代理，dns 解析也是会走clash代理服务解析，由于clash 是fake ip,也会出问题

https 请求 -> adguard vpn -> adguard 分流 -> clash 代理
  
